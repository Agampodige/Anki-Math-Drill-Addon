<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Customize your Math Drill experience with themes, sound, and difficulty settings.">
    <title>Math Drill - Settings</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="theme-loader.js"></script>
    <script src="settings.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-content">
                <h1 class="logo">MathDrill</h1>
                <div class="header-actions">
                    <nav class="nav" role="navigation" aria-label="Main navigation">
                        <a href="index.html" class="nav-link" title="Home">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </a>
                        <a href="progress.html" class="nav-link" title="Progress">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                        </a>
                        <a href="achievements.html" class="nav-link" title="Achievements">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="8" r="7"></circle>
                                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
                            </svg>
                        </a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Customize your Math Drill experience</p>
                </div>
                <div class="settings-actions" style="margin-top: 16px; display: flex; gap: 12px;">
                    <button id="resetSettingsBtn" class="btn btn-secondary" style="padding: 8px 16px; font-size: 13px;">
                        Reset Defaults
                    </button>
                    <button id="exportSettingsBtn" class="btn btn-secondary"
                        style="padding: 8px 16px; font-size: 13px;">
                        Export Settings
                    </button>
                </div>
            </div>

            <div class="settings-grid">
                <!-- Appearance Section -->
                <section class="settings-section" aria-labelledby="appearance-title">
                    <h2 id="appearance-title" class="modal-title"
                        style="font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        Appearance
                    </h2>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Dark Theme</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Easier on the eyes</div>
                        </div>
                        <div id="themeToggle" class="toggle-switch" role="switch" aria-label="Dark Theme" tabindex="0">
                        </div>
                    </div>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Theme Color</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Your accent preference</div>
                        </div>
                        <div class="color-picker" style="display: flex; gap: 8px;">
                            <div class="color-option" data-color="green"
                                style="width: 20px; height: 20px; border-radius: 50%; background: #34d399; cursor: pointer; border: 2px solid transparent;"
                                aria-label="Green theme"></div>
                            <div class="color-option" data-color="blue"
                                style="width: 20px; height: 20px; border-radius: 50%; background: #818cf8; cursor: pointer; border: 2px solid white;"
                                aria-label="Blue theme"></div>
                            <div class="color-option" data-color="purple"
                                style="width: 20px; height: 20px; border-radius: 50%; background: #c084fc; cursor: pointer; border: 2px solid transparent;"
                                aria-label="Purple theme"></div>
                            <div class="color-option" data-color="red"
                                style="width: 20px; height: 20px; border-radius: 50%; background: #f87171; cursor: pointer; border: 2px solid transparent;"
                                aria-label="Red theme"></div>
                        </div>
                    </div>
                </section>

                <!-- Practice Section -->
                <section class="settings-section" aria-labelledby="practice-title" style="margin-top: 24px;">
                    <h2 id="practice-title" class="modal-title"
                        style="font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                        Practice
                    </h2>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Sound Effects</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Audio feedback</div>
                        </div>
                        <div id="soundToggle" class="toggle-switch active" role="switch" aria-label="Sound Effects"
                            tabindex="0"></div>
                    </div>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Show Hints</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Helpful tips</div>
                        </div>
                        <div id="hintsToggle" class="toggle-switch active" role="switch" aria-label="Show Hints"
                            tabindex="0"></div>
                    </div>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Difficulty</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Baseline level</div>
                        </div>
                        <select id="difficultySelect" class="control-select"
                            style="padding: 6px 32px 6px 12px; font-size: 13px;">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate" selected>Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Timer Display</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Show countdown</div>
                        </div>
                        <div id="timerToggle" class="toggle-switch active" role="switch" aria-label="Timer Display"
                            tabindex="0"></div>
                    </div>
                </section>

                <!-- Data Section -->
                <section class="settings-section" aria-labelledby="data-title" style="margin-top: 24px;">
                    <h2 id="data-title" class="modal-title"
                        style="font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Data & Storage
                    </h2>
                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600;">Export Data</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Download history</div>
                        </div>
                        <button id="exportDataBtn" class="btn btn-secondary"
                            style="padding: 6px 12px; font-size: 12px;">Export</button>
                    </div>
                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600; color: var(--error);">Reset All Data</div>
                            <div style="font-size: 12px; color: var(--text-tertiary);">Permanently delete</div>
                        </div>
                        <button id="resetDataBtn" class="btn btn-secondary"
                            style="padding: 6px 12px; font-size: 12px; border-color: var(--error); color: var(--error); background: rgba(248, 113, 113, 0.1);">Reset</button>
                    </div>
                </section>
            </div>

            <div class="version-info"
                style="margin-top: 40px; text-align: center; color: var(--text-tertiary); font-size: 12px;">
                <p style="font-weight: 600; color: var(--text-secondary);">Math Drill Pro</p>
                <p>Version 1.0.0</p>
                <p style="margin-top: 4px;">Â© 2024 Math Drill</p>
            </div>
        </main>

        <!-- Footer -->
        <footer class="hint-bar">
            Navigate with keyboard shortcuts: <kbd>H</kbd> Home <kbd>P</kbd> Progress <kbd>W</kbd> Weakness <kbd>A</kbd>
            Achievements
        </footer>
    </div>

    <script>
        // Bind UI elements to SettingsManager
        document.addEventListener('DOMContentLoaded', () => {
            // Wait a bit for SettingsManager to initialize
            setTimeout(() => {
                const sm = window.settingsManager;

                if (!sm) {
                    console.error('SettingsManager not available');
                    return;
                }

                // Helper to safely bind click
                const bindClick = (id, fn) => {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('click', fn);
                };

                bindClick('themeToggle', () => sm.toggleTheme());
                bindClick('soundToggle', () => sm.toggleSound());
                bindClick('hintsToggle', () => sm.toggleHints());
                bindClick('timerToggle', () => sm.toggleTimer());
                bindClick('animationsToggle', () => sm.toggleAnimations()); // If element exists
                bindClick('autosaveToggle', () => sm.toggleAutosave()); // If element exists
                bindClick('resetSettingsBtn', () => sm.resetSettings());
                bindClick('exportSettingsBtn', () => sm.exportSettings());
                bindClick('clearCacheBtn', () => sm.clearCache());
                bindClick('exportDataBtn', () => sm.exportData());
                bindClick('resetDataBtn', () => sm.resetData());

                const diffSelect = document.getElementById('difficultySelect');
                if (diffSelect) {
                    diffSelect.addEventListener('change', (e) => sm.setDifficulty(e.target.value));
                }

                // Theme color options
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', () => {
                        // Reset borders
                        document.querySelectorAll('.color-option').forEach(o => o.style.border = '2px solid transparent');
                        // Set active border
                        option.style.border = '2px solid white';
                        sm.setThemeColor(option.dataset.color);
                    });
                });
            }, 100);
        });
    </script>
</body>

</html>