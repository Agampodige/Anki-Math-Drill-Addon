<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track your math skills improvement, accuracy, and speed over time.">
    <title>Progress · Math Drill</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="theme-loader.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-content">
                <h1 class="logo">MathDrill</h1>
                <div class="header-actions">
                    <nav class="nav" role="navigation" aria-label="Main navigation">
                        <a href="index.html" class="nav-link" title="Home">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </a>
                        <a href="progress.html" class="nav-link active" title="Progress">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                        </a>
                        <a href="weakness.html" class="nav-link" title="Weakness">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8l4 4-4 4M8 12h8"></path>
                            </svg>
                        </a>
                        <a href="settings.html" class="nav-link" title="Settings">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                        </a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Progress</h1>
                <p class="page-subtitle">Track improvement over time</p>
            </div>

            <div id="loadingSpinner" class="loading-spinner"
                style="display: none; text-align: center; color: var(--text-tertiary); padding: 40px;">
                <div class="spinner"></div>
                <p>Loading progress data...</p>
            </div>

            <!-- Stats Overview -->
            <div class="card" id="statsOverview">
                <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="stat-card">
                        <div class="stat-value main-stat" id="totalQuestions"
                            style="font-size: 28px; color: var(--primary);">0</div>
                        <div class="stat-label">Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value main-stat" id="avgAccuracy"
                            style="font-size: 28px; color: var(--success);">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value main-stat" id="avgSpeed" style="font-size: 28px; color: var(--warning);">
                            0.0s</div>
                        <div class="stat-label">Avg Speed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value main-stat" id="currentStreak"
                            style="font-size: 28px; color: var(--accent);">0</div>
                        <div class="stat-label">Streak</div>
                    </div>
                </div>
            </div>

            <!-- Performance Chart -->
            <div class="card" style="padding-bottom: 32px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                    <h3 class="section-title" style="margin-bottom: 0; font-weight: 700;">Performance History</h3>
                    <div class="chart-controls" style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                        <div class="period-selector" style="display: flex; gap: 4px; background: rgba(255,255,255,0.05); padding: 2px; border-radius: 6px;">
                            <button class="period-btn active" data-period="week" style="padding: 6px 12px; font-size: 12px; border: none; background: var(--primary); color: white; cursor: pointer; border-radius: 4px; transition: all 0.2s;">Weekly</button>
                            <button class="period-btn" data-period="month" style="padding: 6px 12px; font-size: 12px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; transition: all 0.2s;">Monthly</button>
                            <button class="period-btn" data-period="year" style="padding: 6px 12px; font-size: 12px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; transition: all 0.2s;">Yearly</button>
                            <button class="period-btn" data-period="all" style="padding: 6px 12px; font-size: 12px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; transition: all 0.2s;">All Time</button>
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <label class="toggle-label"
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="toggleAccuracy" checked style="accent-color: #2ECC71;">
                                <span style="color: var(--text-secondary);">Accuracy</span>
                            </label>
                            <label class="toggle-label"
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="toggleSpeed" checked style="accent-color: #e0af68;">
                                <span style="color: var(--text-secondary);">Speed</span>
                            </label>
                            <label class="toggle-label"
                                style="display: flex; align-items: center; gap: 6px; font-size: 13px; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="toggleQuestions" checked style="accent-color: #818cf8;">
                                <span style="color: var(--text-secondary);">Questions</span>
                            </label>
                        </div>
                    </div>
                </div>
                <!-- Interactive Canvas Container -->
                <div style="position: relative; width: 100%; height: 250px;">
                    <canvas id="performanceChart"></canvas>
                    <div id="chartTooltip"
                        style="position: absolute; display: none; background: rgba(0, 0, 0, 0.8); color: white; padding: 8px 12px; border-radius: 4px; pointer-events: none; font-size: 12px; white-space: nowrap; z-index: 10; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                    </div>
                </div>
            </div>

            <!-- Learning Velocity & Activity Heatmap -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
                <!-- Learning Velocity -->
                <div class="card" style="margin-bottom: 0; display: flex; flex-direction: column;">
                    <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Learning Velocity</h3>
                    <div id="velocityContainer"
                        style="display: flex; flex-direction: column; gap: 12px; flex-grow: 1; justify-content: center;">
                        <div style="text-align: center; color: var(--text-tertiary); padding: 20px;">
                            <p>Loading velocity data...</p>
                        </div>
                    </div>
                </div>

                <!-- Activity Heatmap -->
                <div class="card" style="margin-bottom: 0;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 class="section-title" style="margin-bottom: 0; font-weight: 700;">Consistency</h3>
                        <div class="heatmap-toggles"
                            style="display: flex; gap: 4px; background: rgba(255,255,255,0.05); padding: 2px; border-radius: 6px;">
                            <button class="view-btn active" data-view="month"
                                style="padding: 4px 8px; font-size: 11px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; transition: all 0.2s;">Month</button>
                            <button class="view-btn" data-view="year"
                                style="padding: 4px 8px; font-size: 11px; border: none; background: transparent; color: var(--text-secondary); cursor: pointer; border-radius: 4px; transition: all 0.2s;">Year</button>
                        </div>
                    </div>
                    <div id="heatmapContainer" style="padding: 10px 0;">
                        <div id="activityHeatmap"
                            style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; max-width: 250px; margin: 0 auto;">
                            <!-- Generated by JS -->
                        </div>
                        <div
                            style="display: flex; justify-content: center; gap: 12px; margin-top: 16px; font-size: 11px; color: var(--text-tertiary);">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div
                                    style="width: 10px; height: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 2px;">
                                </div>
                                <span>None</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div
                                    style="width: 10px; height: 10px; background: rgba(46, 204, 113, 0.3); border-radius: 2px;">
                                </div>
                                <span>Light</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div
                                    style="width: 10px; height: 10px; background: rgba(46, 204, 113, 1); border-radius: 2px;">
                                </div>
                                <span>Heavy</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adaptive Insights -->
            <div class="card" id="adaptiveInsightsCard" style="display: none; margin-bottom: 24px;">
                <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Coach's Recommendations</h3>
                <div id="adaptiveInsightsList"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Skills Mastery -->
            <div class="card">
                <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Skills Mastery</h3>
                <div class="mastery-grid-large" id="masteryGridLarge">
                    <!-- Generated by JavaScript -->
                </div>
            </div>

            <!-- Personal Bests -->
            <div class="card">
                <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Personal Bests</h3>
                <div id="personalBests"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Achievements -->
            <div class="card">
                <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Achievements Progress</h3>
                <div id="achievementProgress">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <h3 class="section-title" style="margin-bottom: 16px; font-weight: 700;">Recent Activity</h3>
                <div class="activity-list" id="recentActivity">
                    <div class="loading-spinner"
                        style="text-align: center; font-size: 13px; color: var(--text-tertiary);">
                        <p>Loading activity...</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="hint-bar">
            Navigate with keyboard shortcuts: <kbd>H</kbd> Home <kbd>W</kbd> Weakness <kbd>A</kbd> Achievements
            <kbd>S</kbd> Settings
        </footer>
    </div>

    <!-- QWebChannel Bridge -->
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
        // Initialize QWebChannel bridge
        window.addEventListener('load', function () {
            if (typeof qt !== 'undefined' && qt.webChannelTransport) {
                new QWebChannel(qt.webChannelTransport, function (channel) {
                    window.pythonBridge = channel.objects.pythonBridge;
                    console.log('✅ Progress page: Python bridge initialized successfully');

                    // Initialize the progress page after bridge is ready
                    if (typeof ProgressPage !== 'undefined') {
                        window.progressPage = new ProgressPage();
                    }
                });
            } else {
                console.warn('❌ Qt WebChannel not available - running in standalone mode');
                // Initialize app in standalone mode for testing
                if (typeof ProgressPage !== 'undefined') {
                    window.progressPage = new ProgressPage();
                }
            }
        });
    </script>

    <style>
        .view-btn.active {
            background: var(--primary) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .period-btn.active {
            background: var(--primary) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.1) !important;
        }
        .period-btn.active:hover {
            background: var(--primary) !important;
            transform: translateY(0px);
        }
        .period-btn {
            transition: all 0.2s ease, transform 0.2s ease;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .chart-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            .period-selector {
                justify-content: center;
                order: -1;
            }
            .toggle-controls {
                order: 1;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            .period-btn {
                font-size: 11px;
                padding: 5px 10px;
                min-width: 60px;
            }
            .toggle-label {
                font-size: 12px;
                white-space: nowrap;
            }
        }
        
        @media (max-width: 480px) {
            .chart-controls {
                gap: 8px;
            }
            .period-btn {
                font-size: 10px;
                padding: 4px 8px;
                min-width: 50px;
            }
            .toggle-label span {
                font-size: 11px;
            }
        }
    </style>
    <script src="progress.js"></script>
</body>

</html>